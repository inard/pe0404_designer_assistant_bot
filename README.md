# Бот-ассистент веб-дизайнера

Бот доступен одновременно в Telegram и на веб-сайте через чат-виджет.

## Задачи бота

* Отвечать на вопросы клиентов по услугам.
* Принимать заявки на личную консультацию.
* Сохранять заявки в Google Sheets.
* Отправлять уведомления о заявках в служебную группу Telegram.

## Примеры диалогов

### 1. Чат на сайте

Окно чата скрыто, видна только кнопка для его активации:

![Чат на сайте 1](./img/01.%20%D0%A7%D0%B0%D1%82%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%201.png)

Окно чата активировано, получено приветствие бота, пользователь вводит многострочный вопрос:

![Чат на сайте 2](./img/02.%20%D0%A7%D0%B0%D1%82%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%202.png)

Бот готовит ответ:

![Чат на сайте 3](./img/03.%20%D0%A7%D0%B0%D1%82%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%203.png)

Бот ответил на вопрос и предложил записаться на консультацию, пользователь обозначает дату и время:

![Чат на сайте 4](./img/04.%20%D0%A7%D0%B0%D1%82%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%204.png)

Бот уточнил дату, получил от пользователя необходимые данные, сообщает об успешной отправке заявки:

![Чат на сайте 5](./img/05.%20%D0%A7%D0%B0%D1%82%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%205.png)

Заявка сохранена в Google Sheets:

![Google Sheets 1](./img/06.%20Google%20Sheets%201.png)

Уведомление о заявке отправлено в служебную группу Telegram:

![Группа в Telegram 1](./img/07.%20%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%B0%20%D0%B2%20Telegram%201.png)

### 2. Чат в Telegram

Получено приветствие бота, пользователь представился, объяснил ситуацию и задал вопрос. Бот ответил на вопрос и предложил записаться на консультацию, пользователь обозначает дату и время:

![Чат в Telegram 1](./img/08.%20%D0%A7%D0%B0%D1%82%20%D0%B2%20Telegram%201.png)

Бот уточнил дату, получил от пользователя необходимые данные, сообщает об успешной отправке заявки:

![Чат в Telegram 2](./img/09.%20%D0%A7%D0%B0%D1%82%20%D0%B2%20Telegram%202.png)

Заявка сохранена в Google Sheets:

![Google Sheets 2](./img/10.%20Google%20Sheets%202.png)

Уведомление о заявке отправлено в служебную группу Telegram:

![Группа в Telegram 2](./img/11.%20%D0%93%D1%80%D1%83%D0%BF%D0%BF%D0%B0%20%D0%B2%20Telegram%202.png)

## Архитектура бота

![Архитектура бота](./img/12.%20%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0%20%D0%B1%D0%BE%D1%82%D0%B0.png)

## Настройки бота

### 1. Webhook для Telegram

Настройте webhook для Telegram, указав адрес Flask-приложения, работающего в вашем домене, например, `https://example.com/webhook`.

### 2. Служебная учётная запись Google

В каталоге `app` создайте текстовый файл `credentials.json` с настройками служебной учётной записи Google.

### 3. Таблица Google Sheets

В Google Sheets создайте таблицу со столбцами

* `Имя`,
* `Телефон`,
* `Дата и время`,
* `Комментарий`,
* `Источник обращения`

и дайте право на её редактирование служебной учётной записи Google.

### 4. Идентификаторы, ключи и токены

В каталоге `app` создайте текстовый файл `.env` следующего содержания:

```text
FLASK_SECRET_KEY=
TELEGRAM_WEBHOOK_URL=/webhook
TELEGRAM_BOT_TOKEN=
TELEGRAM_GROUP_ID=
OPENAI_API_KEY=
OPENAI_ASSISTANT_ID=
GOOGLE_SERVICE_ACCOUNT=credentials.json
GOOGLE_SHEETS_ID=
```

Укажите свои идентификаторы, ключи и токены.

## Запуск бота

1. В каталоге `app` создайте и активируйте виртуальное окружение:
    ```bash
    python3 -m venv .venv
    source .venv/bin/activate
    ```
2. Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
3. Запустите приложение:
    ```bash
    python app.py
    ```
